@page "/departaments/add"

@using AutoMapper
@using MediatR
@using NursesScheduler.BlazorShared.ViewModels
@using NursesScheduler.BusinessLogic.CommandsAndQueries.Departaments.Commands.CreateDepartament
@inject IMediator mediatr;
@inject IMapper mapper;
@inject NavigationManager NavManager

<NursesScheduler.BlazorShared.Controls.Departaments.DepartamentForm Title="Dodaj nowy oddział" Departament=@departament SaveOnClick="SaveDepartament"/>


@code {
    protected DepartamentViewModel departament = new DepartamentViewModel();
    protected async void SaveDepartament()
    {
        try
        {
            var request = mapper.Map<CreateDepartamentRequest>(departament);
            var response = await mediatr.Send(request);
            Console.WriteLine(response.Id);

            NavManager.NavigateTo("/departaments");
        }
        catch (Exception e)
        {
            NavManager.NavigateTo("/error");
        }
    }
}
